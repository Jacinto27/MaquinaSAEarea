<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.165">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Andrés Gutiérrez">
<meta name="author" content="Stalyn Guerrero">
<meta name="dcterms.date" content="2023-02-27">

<title>Estimación de la tasa de informalidad en República Dominicana empleando modelos de área con transformación arcoseno</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="04 fh emdi_files/libs/clipboard/clipboard.min.js"></script>
<script src="04 fh emdi_files/libs/quarto-html/quarto.js"></script>
<script src="04 fh emdi_files/libs/quarto-html/popper.min.js"></script>
<script src="04 fh emdi_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="04 fh emdi_files/libs/quarto-html/anchor.min.js"></script>
<link href="04 fh emdi_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="04 fh emdi_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="04 fh emdi_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="04 fh emdi_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="04 fh emdi_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="04 fh emdi_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="04 fh emdi_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Estimación de la tasa de informalidad en República Dominicana empleando modelos de área con transformación arcoseno</h1>
<p class="subtitle lead">Validación del modelo de área</p>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Authors</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    Andrés Gutiérrez 
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            CEPAL - Unidad de Estadísticas Sociales
          </p>
      </div>
      <div class="quarto-title-meta-contents">
    Stalyn Guerrero 
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            CEPAL - Unidad de Estadísticas Sociales
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 27, 2023</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="lectura-de-librerías" class="level2">
<h2 class="anchored" data-anchor-id="lectura-de-librerías">Lectura de librerías</h2>
<div class="cell" data-hash="0Recursos/04/unnamed-chunk-1_732f8a2e31c9d0a9999d4a7aa1b06e3f">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(TeachingSampling)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sae)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emdi)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(BayesSAE)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mice)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>select <span class="ot">&lt;-</span> dplyr<span class="sc">::</span>select</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="leer-bases-de-datos" class="level2">
<h2 class="anchored" data-anchor-id="leer-bases-de-datos">Leer bases de datos</h2>
<p>El código lee varios archivos y realiza algunas transformaciones en una base de datos de estimaciones de la tasa de informalidad en diferentes dominios geográficos.</p>
<p>Primero, se lee un archivo Shapefile llamado <code>DOM.shp</code> que contiene la información geográfica de los polígonos de los diferentes dominios. Luego, se lee una base de datos completa de donde se extraen las estimaciones de la tasa de informalidad en los diferentes dominios.</p>
<p>A continuación, se lee un modelo FH (Fay-Herriot) con transformación Arcoseno, que es utilizado para estimar las tasas de informalidad en los diferentes dominios geográficos. También se leen las estimaciones del modelo FH con transformación Arcoseno y se calculan algunas medidas de error como el RMSE (Root Mean Squared Error), RRMSE (Relative Root Mean Squared Error) y la desviación estándar del error de la estimación Directa.</p>
<div class="cell" data-hash="0Recursos/04/unnamed-chunk-2_0b8c92f39af28b20f78ed497b717b1dc">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Shapefile</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>poligonos_dominio <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"../shapefiles2010/DOM.shp"</span> )</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Base de datos completa </span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>base_completa <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">'../Data/base_completa.Rds'</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo FH con transformación Arcoseno </span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>fh_arcsin <span class="ot">&lt;-</span>  <span class="fu">readRDS</span>(<span class="st">"../Data/fh_arcsin.Rds"</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimaciones del modelo FH con transformación Arcoseno </span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>estimaciones <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">'../Data/estimaciones.Rds'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rrmse_FH =</span> <span class="fu">sqrt</span>(FH_MSE) <span class="sc">/</span> FH,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">rmse_FH =</span> <span class="fu">sqrt</span>(FH_MSE),</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">Direct_ee =</span> <span class="fu">sqrt</span>(Direct_MSE))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="análisis-de-residuales-y-efectos-aleatorios" class="level1">
<h1>Análisis de residuales y efectos aleatorios</h1>
<p>El código muestra cómo calcular y graficar los residuos estandarizados de un modelo de FH de datos transformados con la función arcoseno.</p>
<p>En primer lugar, se calculan los residuos estandarizados del modelo, utilizando la fórmula (valor observado - valor predicho) / desviación estándar de los residuos. Luego, se calculan los residuos estandarizados de los efectos aleatorios del modelo, utilizando la misma fórmula pero con los efectos aleatorios en lugar de los residuos.</p>
<p>Finalmente, se grafican los residuos estandarizados de los datos utilizando <code>ggplot2</code>. Se muestra un gráfico de puntos de los residuos estandarizados en función del índice de observación. También se traza una línea horizontal en el valor cero para facilitar la identificación de puntos que estén lejos de cero.</p>
<div class="cell" data-hash="0Recursos/04/unnamed-chunk-3_05e15127dda9f5a108763b6a867fa4a8">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Residuales estandarizados ---#</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>residuals <span class="ot">&lt;-</span> fh_arcsin<span class="sc">$</span>model<span class="sc">$</span>real_residuals</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>std_residuals <span class="ot">&lt;-</span> (residuals <span class="sc">-</span> <span class="fu">mean</span>(residuals)) <span class="sc">/</span> <span class="fu">sd</span>(residuals)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Residuales estandarizados de los efectos aleatorios ---#</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>rand.eff <span class="ot">&lt;-</span> fh_arcsin<span class="sc">$</span>model<span class="sc">$</span>random_effects</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>srand.eff <span class="ot">&lt;-</span> (rand.eff <span class="sc">-</span> <span class="fu">mean</span>(rand.eff)) <span class="sc">/</span> <span class="fu">sd</span>(rand.eff)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Gráfico de residuales estandarizados ---#</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">Residuals =</span> fh_arcsin<span class="sc">$</span>model<span class="sc">$</span>std_real_residuals)) <span class="sc">+</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Residuals, <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(Residuals))) <span class="sc">+</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Residuales estandarizados"</span>, <span class="at">x =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/04/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="qq-plots" class="level3">
<h3 class="anchored" data-anchor-id="qq-plots">QQ plots</h3>
<p>Este código genera dos gráficos QQ (quantile-quantile) para evaluar si los residuos y los efectos aleatorios del modelo FH con transformación Arcoseno siguen una distribución normal.</p>
<p>Primero, se calculan los residuos estandarizados y los efectos aleatorios estandarizados dividiéndolos por su desviación estándar y restando su media. Luego, se crea el primer gráfico QQ utilizando <code>ggplot2</code>, que muestra una comparación de la distribución empírica de los residuos estandarizados con una distribución normal teórica. El segundo gráfico QQ realiza la misma comparación, pero para los efectos aleatorios estandarizados.</p>
<p>Finalmente, se utiliza el operador | para unir los dos gráficos QQ en una única visualización.</p>
<div class="cell" data-hash="0Recursos/04/unnamed-chunk-4_39216f605cd4c208f5023ff8d0a4332f">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">Residuals =</span> std_residuals),</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">sample =</span> Residuals)) <span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq</span>() <span class="sc">+</span> <span class="fu">stat_qq_line</span>(<span class="at">col =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"qqplot - residuales estandarizados"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">Residuals =</span> srand.eff),</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">sample =</span> Residuals)) <span class="sc">+</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq</span>() <span class="sc">+</span> <span class="fu">stat_qq_line</span>(<span class="at">col =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"qqplot - efectos aleatorios"</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">|</span> p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/04/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="densidades" class="level3">
<h3 class="anchored" data-anchor-id="densidades">Densidades</h3>
<p>Este código genera dos gráficos de densidad para los residuales estandarizados y los efectos aleatorios estandarizados del modelo FH con transformación Arcoseno. En cada gráfico se utiliza la función ggplot para crear un objeto de gráfico y se establecen los datos, el eje x y los colores de las líneas y relleno de los gráficos de densidad.</p>
<p>Para el gráfico de densidad de los residuales estandarizados (p3), se establece una distribución normal teórica (con la función stat_function) y se define un rango de -4 a 4 en el eje x (con xlim). El color de relleno y línea se establece como azul claro (lightblue3) con un nivel de transparencia de 0.4 (alpha).</p>
<p>En el gráfico de densidad de los efectos aleatorios estandarizados (p4), se establece también una distribución normal teórica y un rango de -4 a 4 en el eje x, pero se utiliza el mismo color de relleno y línea que en el gráfico de densidad de los residuales estandarizados (color[2]). Ambos gráficos se combinan utilizando el operador “|” para presentarse en la misma línea.</p>
<div class="cell" data-hash="0Recursos/04/unnamed-chunk-5_c4a433e59c4ae825c0b944357395eca5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>color <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"lightblue3"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">Residuals =</span> std_residuals),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Residuals),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> color[<span class="dv">2</span>],</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> color[<span class="dv">2</span>]</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> color[<span class="dv">2</span>],</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> color[<span class="dv">2</span>],</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm) <span class="sc">+</span> <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Densidad - residuales estandarizados"</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">Residuals =</span> srand.eff),</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Residuals),</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> color[<span class="dv">2</span>],</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> color[<span class="dv">2</span>]</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> color[<span class="dv">2</span>],</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> color[<span class="dv">2</span>],</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm) <span class="sc">+</span> <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Densidad - efectos aleatorios"</span>)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>p3 <span class="sc">|</span> p4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/04/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="0Recursos/04/unnamed-chunk-6_b9109680afec7770215900116bf81872">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">summary</span>(fh_arcsin)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>a<span class="sc">$</span>normality <span class="sc">%&gt;%</span> <span class="fu">tba</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> Skewness </th>
   <th style="text-align:right;"> Kurtosis </th>
   <th style="text-align:right;"> Shapiro_W </th>
   <th style="text-align:right;"> Shapiro_p </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Standardized_Residuals </td>
   <td style="text-align:right;"> 0.2087 </td>
   <td style="text-align:right;"> 2.7168 </td>
   <td style="text-align:right;"> 0.9890 </td>
   <td style="text-align:right;"> 0.6659 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Random_effects </td>
   <td style="text-align:right;"> 0.2712 </td>
   <td style="text-align:right;"> 2.8440 </td>
   <td style="text-align:right;"> 0.9902 </td>
   <td style="text-align:right;"> 0.7491 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</section>
</section>
<section id="coeficiente-de-determinación" class="level1">
<h1>Coeficiente de determinación</h1>
<p>Este fragmento de código ajusta un modelo FH y calcula el coeficiente de determinación (R2) del modelo.</p>
<p>Primero, filtra las observaciones de <code>estimaciones</code> que no tienen valores nulos en la columna <code>Gamma</code>. Luego, une los datos filtrados con la base de datos completa <code>base_completa</code> mediante una operación de <code>inner_join()</code>.</p>
<p>A continuación, se obtienen los coeficientes del modelo ajustado <code>fh_arcsin</code> y se almacenan en una matriz llamada <code>Betas</code>. También se crea una matriz <code>XS</code> que contiene las variables independientes de la regresión para cada observación de <code>base_dir</code>.</p>
<p>El código luego calcula los residuos del modelo utilizando la matriz <code>XS</code> y <code>Betas</code>. El error cuadrático medio (MSE) se estima a partir de los residuos y se almacena en <code>S2Beta</code>.</p>
<p>La variable <code>su2</code> contiene la varianza residual del modelo FH ajustado y se utiliza para calcular el coeficiente de determinación (<code>R2</code>) del modelo. Finalmente, el código muestra el valor de <code>R2</code> calculado.</p>
<div class="cell" data-hash="0Recursos/04/unnamed-chunk-7_a5e59942aac591f7deef52175f7fb9ee">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>dom_obs <span class="ot">&lt;-</span> estimaciones <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Gamma)) </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>base_dir <span class="ot">&lt;-</span> base_completa <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(<span class="at">x =</span> dom_obs)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Coeficientes del modelo ajustado ---#</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>Betas <span class="ot">&lt;-</span>  <span class="fu">as.matrix</span>(fh_arcsin<span class="sc">$</span>model<span class="sc">$</span>coefficients[, <span class="dv">1</span>], <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(Betas) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(fh_arcsin<span class="sc">$</span>model<span class="sc">$</span>coefficients)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>XS <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">as.matrix</span>(base_dir <span class="sc">%&gt;%</span> </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>                        dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">rownames</span>(Betas))))</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>residuos <span class="ot">&lt;-</span> XS <span class="sc">%*%</span> Betas <span class="sc">-</span> <span class="fu">c</span>(<span class="fu">colMeans</span>(XS) <span class="sc">%*%</span> Betas)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">dim</span>(XS)[<span class="dv">1</span>]</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="fu">dim</span>(XS)[<span class="dv">2</span>]</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>S2Beta <span class="ot">&lt;-</span> <span class="fu">sum</span>(residuos <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">/</span> (D <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>su2 <span class="ot">&lt;-</span> fh_arcsin<span class="sc">$</span>model<span class="sc">$</span>variance</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>(R2 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (su2 <span class="sc">/</span> (((D <span class="sc">-</span> q) <span class="sc">/</span> (D <span class="sc">-</span> <span class="dv">1</span>)) <span class="sc">*</span> su2 <span class="sc">+</span> S2Beta)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9927712</code></pre>
</div>
</div>
<section id="validaciones-en-relación-al-tamaño-de-la-muestra" class="level2">
<h2 class="anchored" data-anchor-id="validaciones-en-relación-al-tamaño-de-la-muestra">Validaciones en relación al tamaño de la muestra</h2>
<p>Este código genera un gráfico que compara las estimaciones obtenidas a partir de dos métodos diferentes (“Directo” y “Fay Herriot”) en función del tamaño muestral de los dominios.</p>
<p>Primero, se define el número de dominios como la cantidad de filas en <code>base_completa</code>. Luego, se utiliza <code>ggplot()</code> para generar el gráfico. Se utiliza <code>geom_line()</code> para trazar una línea para cada uno de los dos métodos, especificando los colores correspondientes (“Directo” en azul y “Fay Herriot” en rojo) en <code>scale_color_manual()</code>. El eje x se etiqueta con el tamaño muestral de los dominios y el eje y se etiqueta como “Formalidad”.</p>
<p>La escala del eje x se personaliza para que los intervalos sean de 10 unidades, con las etiquetas correspondientes obtenidas de <code>estimaciones$n</code>.</p>
<div class="cell" data-hash="0Recursos/04/unnamed-chunk-8_efd42e586cebb3eddc8a2eb0ba433b48">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>N_dominios <span class="ot">&lt;-</span> <span class="fu">nrow</span>(base_completa)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(estimaciones[<span class="fu">order</span>(estimaciones<span class="sc">$</span>n), ],</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span>N_dominios)) <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Direct, <span class="at">color =</span> <span class="st">"Directo"</span>)) <span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> FH, <span class="at">color =</span> <span class="st">"Fay Herriot"</span>)) <span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Formalidad"</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Tamaño muestral"</span>, <span class="at">color =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, N_dominios, <span class="at">by =</span> <span class="dv">10</span>),</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> estimaciones<span class="sc">$</span>n[<span class="fu">order</span>(estimaciones<span class="sc">$</span>n)][<span class="fu">seq</span>(<span class="dv">1</span>, N_dominios, <span class="at">by =</span> <span class="dv">10</span>)]) <span class="sc">+</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Directo"</span> <span class="ot">=</span> <span class="st">"Blue"</span>, <span class="st">"Fay Herriot"</span> <span class="ot">=</span> <span class="st">"red"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/04/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Estimación directa vs Fay-Herriot</p>
<p>Este código crea un gráfico de dispersión con una línea de ajuste lineal para comparar las estimaciones obtenidas mediante la estimación directa y la estimación de Fay-Herriot</p>
<ul>
<li>La función <code>ggplot()</code> recibe como argumento el conjunto de datos <code>estimaciones</code> y define la variable <code>Direct</code> para el eje x y la variable <code>FH</code> para el eje y.</li>
<li><code>geom_point()</code> agrega los puntos correspondientes a cada par de estimaciones para ambas variables.</li>
<li><code>geom_smooth()</code> agrega una línea de ajuste lineal a los puntos utilizando el método “lm” (mínimos cuadrados) por defecto de <code>ggplot()</code>.</li>
<li><code>ggtitle</code> agrega un título al gráfico indicando la comparación de las estimaciones.</li>
</ul>
<div class="cell" data-hash="0Recursos/04/unnamed-chunk-9_5d18a6ea416a16615562defcb64c4201">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(estimaciones, <span class="fu">aes</span>(Direct, FH)) <span class="sc">+</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Comparación de estimaciones"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/04/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="distancias-de-cook" class="level3">
<h3 class="anchored" data-anchor-id="distancias-de-cook">Distancias de Cook</h3>
<p>El código calcula la contribución de cada dominio a la varianza del estimador directo en un diseño de muestreo complejo usando el método de Fay-Herriot.</p>
<p>Primero, se define el tamaño de la población <code>D</code> y se crea un vector <code>CD</code> de longitud <code>D</code> con valores iniciales igual a cero. Luego, se extraen los coeficientes del modelo de regresión lineal ajustado usando el método de Fay-Herriot y se almacenan en <code>Betas</code>.</p>
<p>A continuación, se crea una matriz diagonal <code>V</code> con los valores de la varianza de los errores de muestreo obtenidos del modelo de Fay-Herriot ajustado. El ciclo <code>for</code> itera a través de cada dominio <code>i</code> y ajusta un modelo Fay-Herriot sin ese dominio. Luego, se calculan los coeficientes ajustados del modelo sin el dominio <code>i</code> y se almacenan en <code>Betas_i</code>. Se calcula la diferencia entre los coeficientes ajustados de <code>Betas</code> y <code>Betas_i</code> y se almacena en <code>betaDiff</code>.</p>
<p>Finalmente, se calcula la contribución del dominio <code>i</code> a la varianza del estimador directo multiplicando <code>betaDiff</code> por la matriz <code>t(XS) %*% V %*% XS</code> y dividiendo el resultado por <code>(q - 1)</code>, donde <code>XS</code> es la matriz de diseño, <code>V</code> es la matriz de varianza, <code>q</code> es el número de variables explicativas y <code>betaDiff</code> es la diferencia entre los coeficientes ajustados del modelo completo y el modelo sin el dominio <code>i</code>. La contribución se almacena en la posición <code>i</code> del vector <code>CD</code>.</p>
<div class="cell" data-hash="0Recursos/04/unnamed-chunk-10_6d94af98f9adf0fce3b66d22cce87aea">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">dim</span>(base_completa)[<span class="dv">1</span>]</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>CD <span class="ot">=</span> <span class="fu">numeric</span>(D)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>Betas <span class="ot">&lt;-</span>  <span class="fu">as.matrix</span>(fh_arcsin<span class="sc">$</span>model<span class="sc">$</span>coefficients[, <span class="dv">1</span>], <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>V <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span> <span class="sc">/</span> (su2 <span class="sc">+</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">4</span> <span class="sc">*</span> base_dir<span class="sc">$</span>n_eff_FGV)))</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Ciclo para DC ---#</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>D) {</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(i)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  BetaModelo <span class="ot">&lt;-</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fh</span>(<span class="fu">formula</span>(fh_arcsin<span class="sc">$</span>call<span class="sc">$</span>fixed),</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">vardir =</span> <span class="st">"hat_var"</span>,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">combined_data =</span> base_completa[<span class="sc">-</span>i, ] <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>(),</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">domains =</span> <span class="st">"id_dominio"</span>,</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">method =</span> <span class="st">"reml"</span>,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">transformation =</span> <span class="st">"arcsin"</span>,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">backtransformation =</span> <span class="st">"bc"</span>,</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">eff_smpsize =</span> <span class="st">"n_eff_FGV"</span>,</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">MSE =</span> <span class="cn">FALSE</span>,</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">mse_type =</span> <span class="st">"NULL"</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- Coeficientes del modelo ajustado ---#</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  Betas_i <span class="ot">=</span> <span class="fu">as.matrix</span>(BetaModelo<span class="sc">$</span>model<span class="sc">$</span>coefficients[, <span class="dv">1</span>], <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  betaDiff <span class="ot">&lt;-</span> Betas <span class="sc">-</span> Betas_i</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>  CD[i] <span class="ot">=</span> (<span class="dv">1</span> <span class="sc">/</span> (q <span class="sc">-</span> <span class="dv">1</span>)) <span class="sc">*</span> <span class="fu">t</span>(betaDiff) <span class="sc">%*%</span> (<span class="fu">t</span>(XS) <span class="sc">%*%</span> V <span class="sc">%*%</span> XS) <span class="sc">%*%</span> betaDiff</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>lectura de la distancias de Cook calculadas previamente</p>
<div class="cell" data-hash="0Recursos/04/unnamed-chunk-11_066f046a20e437d6ad6501dc2f0d6c01">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>CD <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Data/cookDis_2021.rds"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">cookDis =</span> CD, <span class="at">dominios =</span> base_completa<span class="sc">$</span>DES_MUNICIPIO) <span class="sc">%&gt;%</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cookDis <span class="sc">&gt;</span> <span class="fl">0.1</span>) <span class="sc">%&gt;%</span> <span class="fu">tba</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:right;"> cookDis </th>
   <th style="text-align:left;"> dominios </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 0.2207 </td>
   <td style="text-align:left;"> JIMANI </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.6132 </td>
   <td style="text-align:left;"> HIGÜEY </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.2151 </td>
   <td style="text-align:left;"> LAS TERRENAS </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1.9380 </td>
   <td style="text-align:left;"> SANTO DOMINGO NORTE </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>Gráfico de Distancias de Cook</p>
<div class="cell" data-hash="0Recursos/04/unnamed-chunk-12_9a685c37aa95b2be98df0be580933906">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">cookDis =</span> CD, <span class="at">dominios =</span> base_completa<span class="sc">$</span>DES_MUNICIPIO) <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> cookDis, <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span>N_dominios)) <span class="sc">+</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">col =</span> <span class="st">"blue"</span>) <span class="sc">+</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">ifelse</span>(cookDis <span class="sc">&gt;</span> <span class="fl">0.1</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">as.character</span>(dominios), <span class="st">''</span>)), </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Distancia de Cook"</span>, <span class="at">x =</span> <span class="st">"Municipios"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/04/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="análisis-gráfico" class="level2">
<h2 class="anchored" data-anchor-id="análisis-gráfico">Análisis gráfico</h2>
<section id="coeficiente-de-variación-y-rrmse" class="level3">
<h3 class="anchored" data-anchor-id="coeficiente-de-variación-y-rrmse">Coeficiente de variación y RRMSE</h3>
<p>Este código genera un gráfico de líneas comparando los coeficientes de variación (CV) del estimador directo y del estimador FH en función del tamaño muestral de los dominios. El eje x muestra el tamaño muestral y el eje y los valores de los coeficientes de variación. El gráfico tiene dos líneas: una para el CV del estimador directo y otra para el RRMSE del estimador FH. Los puntos se conectan mediante una línea recta para una mejor visualización.</p>
<p>El código comienza filtrando los datos de estimaciones para ordenarlos por el tamaño muestral <code>n</code>. Luego, se utiliza la función <code>ggplot()</code> para crear el objeto de la gráfica. Se especifican los datos y las variables que se utilizarán en la gráfica <code>(aes(x = 1:N_dominios)</code> y <code>aes(y = Direct_CV, color = "CV")</code> y <code>aes(y = rrmse_FH, color = "RRMSE"))</code>. Se añaden dos líneas con <code>geom_line()</code> correspondientes a cada estimador, y se establece el título del gráfico con <code>ggtitle()</code>.</p>
<p>Se establecen las etiquetas de los ejes x e y mediante <code>labs()</code> y se definen los valores que aparecerán en el eje x con <code>scale_x_continuous()</code>. Finalmente, se establecen los colores de las líneas con <code>scale_color_manual()</code>.</p>
<div class="cell" data-hash="0Recursos/04/unnamed-chunk-13_fd0ad71305a5589b03550a98726c10e0">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(estimaciones <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">arrange</span>(n), <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span>N_dominios)) <span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Direct_CV, <span class="at">color =</span> <span class="st">"CV"</span>)) <span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> rrmse_FH, <span class="at">color =</span> <span class="st">"RRMSE"</span>)) <span class="sc">+</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Coeficientes de variación"</span>, </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Tamaño muestral"</span>, <span class="at">color =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, N_dominios, <span class="at">by =</span> <span class="dv">10</span>),</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> estimaciones<span class="sc">$</span>n[<span class="fu">order</span>(estimaciones<span class="sc">$</span>n)][<span class="fu">seq</span>(<span class="dv">1</span>, N_dominios, <span class="at">by =</span> <span class="dv">10</span>)]) <span class="sc">+</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"CV"</span> <span class="ot">=</span> <span class="st">"Blue"</span>, <span class="st">"RRMSE"</span> <span class="ot">=</span> <span class="st">"red"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/04/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="error-estándar-y-rrmse" class="level3">
<h3 class="anchored" data-anchor-id="error-estándar-y-rrmse">Error estándar y RRMSE</h3>
<div class="cell" data-hash="0Recursos/04/unnamed-chunk-14_5bf4b77662c37b4a05cf5659ad389f20">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(estimaciones <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">arrange</span>(n), <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span>N_dominios)) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Direct_ee, <span class="at">color =</span> <span class="st">"Directo"</span>)) <span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> rmse_FH, <span class="at">color =</span> <span class="st">"Fay-Herriot"</span>)) <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Error estándar"</span>, </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Tamaño muestral"</span>, <span class="at">color =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, N_dominios, <span class="at">by =</span> <span class="dv">10</span>),</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> estimaciones<span class="sc">$</span>n[<span class="fu">order</span>(estimaciones<span class="sc">$</span>n)][<span class="fu">seq</span>(<span class="dv">1</span>, N_dominios, <span class="at">by =</span> <span class="dv">10</span>)]) <span class="sc">+</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Directo"</span> <span class="ot">=</span> <span class="st">"Blue"</span>, <span class="st">"Fay-Herriot"</span> <span class="ot">=</span> <span class="st">"red"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/04/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="boxplot-cv-directo" class="level3">
<h3 class="anchored" data-anchor-id="boxplot-cv-directo">Boxplot: CV Directo</h3>
<div class="cell" data-hash="0Recursos/04/unnamed-chunk-15_228d1757cdd19f1a29420a75926937e2">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>estimaciones <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span>Direct_CV)) <span class="sc">+</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/04/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="boxplot-cv-directo-y-rrmse-fh-observados" class="level3">
<h3 class="anchored" data-anchor-id="boxplot-cv-directo-y-rrmse-fh-observados">Boxplot: CV Directo y RRMSE FH (observados)</h3>
<div class="cell" data-hash="0Recursos/04/unnamed-chunk-16_3bbb58e9f382f8dc7a2fc1d9252c7517">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>melted <span class="ot">&lt;-</span> estimaciones <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Direct_CV)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Direct_CV, rrmse_FH) <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">melt</span>()</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(melted, <span class="fu">aes</span>(<span class="fu">factor</span>(variable), value)) <span class="sc">+</span> </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()  <span class="sc">+</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Coeficiente de variación"</span>, <span class="at">x =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/04/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="boxplot-cv-directo-y-rrmse-fh" class="level3">
<h3 class="anchored" data-anchor-id="boxplot-cv-directo-y-rrmse-fh">Boxplot: CV Directo y RRMSE FH</h3>
<div class="cell" data-hash="0Recursos/04/unnamed-chunk-17_274b4641dacb50812f606e30631836bd">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>melted <span class="ot">&lt;-</span> estimaciones <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Direct_CV, rrmse_FH) <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">melt</span>()</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(melted, <span class="fu">aes</span>(<span class="fu">factor</span>(variable), value)) <span class="sc">+</span> </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()  <span class="sc">+</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Coeficiente de variación"</span>, <span class="at">x =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/04/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="boxplot-error-estándar-directo-y-rmse-fh-observados" class="level3">
<h3 class="anchored" data-anchor-id="boxplot-error-estándar-directo-y-rmse-fh-observados">Boxplot: Error estándar Directo y RMSE FH (observados)</h3>
<div class="cell" data-hash="0Recursos/04/unnamed-chunk-18_ea1ea435d2739e9c3c78386b0c1c91b9">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>melted <span class="ot">&lt;-</span> estimaciones <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Direct_CV)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Direct_ee, rmse_FH) <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">melt</span>()</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(melted, </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="fu">factor</span>(variable), value)) <span class="sc">+</span> </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Errores estándar"</span>, <span class="at">x =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/04/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="boxplot-error-estándar-directo-y-rmse-fh" class="level3">
<h3 class="anchored" data-anchor-id="boxplot-error-estándar-directo-y-rmse-fh">Boxplot: Error estándar Directo y RMSE FH</h3>
<div class="cell" data-hash="0Recursos/04/unnamed-chunk-19_77675d85af1d5380a15fa2808be730fa">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>melted <span class="ot">&lt;-</span> estimaciones <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Direct_ee, rmse_FH) <span class="sc">%&gt;%</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">melt</span>()</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(melted, </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="fu">factor</span>(variable), value)) <span class="sc">+</span> </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Errores estándar"</span>, <span class="at">x =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/04/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="matriz-vecinos-cercanos" class="level2">
<h2 class="anchored" data-anchor-id="matriz-vecinos-cercanos">Matriz vecinos cercanos</h2>
<div class="cell" data-hash="0Recursos/04/unnamed-chunk-20_c7c2404b0ca567fba2d57b88a9a11f1b">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Construyendo la matriz de vecinos de una lista de polígonos ---#</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>lista_comvecinos <span class="ot">&lt;-</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  spdep<span class="sc">::</span><span class="fu">poly2nb</span>(<span class="at">pl =</span> poligonos_dominio, <span class="at">queen =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Cargando: Matriz de vecinos</p>
<div class="cell" data-hash="0Recursos/04/unnamed-chunk-21_0783efc11eb709f1881b7f29899f3b57">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>lista_comvecinos <span class="ot">&lt;-</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">readRDS</span>(<span class="st">"../Data/lista_comvecinos.rds"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Matrices de ponderaciones espaciales para matriz de vecinos ---#</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>W <span class="ot">&lt;-</span> <span class="fu">nb2mat</span>(lista_comvecinos, <span class="at">zero.policy =</span> T)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Nombrando las filas y columnas de la matriz de ponderaciones espaciales --#</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(W) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(poligonos_dominio<span class="sc">$</span>id_dominio)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(W) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(poligonos_dominio<span class="sc">$</span>id_dominio)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Ordenando las filas y columnas de la matriz de ponderaciones espaciales --#</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>W <span class="ot">&lt;-</span> W[<span class="fu">order</span>(<span class="fu">row.names</span>(W)),]</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>W <span class="ot">&lt;-</span> W[, <span class="fu">order</span>(<span class="fu">colnames</span>(W))]</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="co">#----  Comunas que se encuentran en la matriz de pesos W y de estimaciones  ---#</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>fil <span class="ot">&lt;-</span> <span class="fu">row.names</span>(W) <span class="sc">%in%</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>  estimaciones<span class="sc">$</span>id_dominio[<span class="sc">!</span><span class="fu">is.na</span>(estimaciones<span class="sc">$</span>FH)]</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>W2 <span class="ot">&lt;-</span> W[fil, fil]</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Pruebas de correlación espacial de Moran's I y Geary's C ---#</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a><span class="fu">spatialcor.tests</span>(estimaciones<span class="sc">$</span>FH[fil], W2) <span class="sc">%&gt;%</span> <span class="fu">tba</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> Statistics </th>
   <th style="text-align:right;"> Value </th>
   <th style="text-align:right;"> p.value </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Moran's I </td>
   <td style="text-align:right;"> 0.0992 </td>
   <td style="text-align:right;"> 0.0209 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Geary's C </td>
   <td style="text-align:right;"> 0.8567 </td>
   <td style="text-align:right;"> 0.0055 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>